# XHS Category Backfill 执行报告

**执行时间**: 2026-01-26
**执行人**: Claude Sonnet 4.5
**脚本**: `scripts/backfill-xhs-categories.ts`

---

## 执行结果

### 总体统计

| 指标 | 数值 | 百分比 |
|------|------|--------|
| 总记录数 | 550 | 100% |
| 成功分类 | 203 | **36.91%** |
| 未能分类 | 347 | 63.09% |
| 更新失败 | 0 | 0% |

### 置信度分布

| 置信度等级 | 数量 | 说明 |
|-----------|------|------|
| 高 (≥0.8) | 138 | 规则匹配明确 |
| 中 (0.5-0.8) | 62 | 规则匹配一般 |
| 低 (<0.5) | 0 | 无 |
| 未分类 | 347 | 不符合任何规则 |

---

## 分类分布

### Category (内容类型)

| Category | 数量 | 占比 |
|----------|------|------|
| `knowledge` (知识科普) | 121 | 59.61% |
| `recommendation` (推荐种草) | 46 | 22.66% |
| `tutorial` (教程) | 28 | 13.79% |
| `explore` (探店) | 7 | 3.45% |
| `review` (测评) | 1 | 0.49% |

### Track (内容赛道)

| Track | 数量 | 占比 |
|-------|------|------|
| `lifestyle` (生活方式) | 171 | 84.24% |
| `food` (美食) | 3 | 1.48% |
| `null` (未设置) | 29 | 14.29% |

### Category + Track 组合

| Category | Track | 数量 | 占比 |
|----------|-------|------|------|
| knowledge | lifestyle | 104 | 51.23% |
| recommendation | lifestyle | 41 | 20.20% |
| tutorial | lifestyle | 20 | 9.85% |
| knowledge | (null) | 16 | 7.88% |
| tutorial | (null) | 8 | 3.94% |
| explore | lifestyle | 6 | 2.96% |
| recommendation | (null) | 5 | 2.46% |
| explore | food | 1 | 0.49% |
| knowledge | food | 1 | 0.49% |
| tutorial | food | 1 | 0.49% |

---

## 分类规则效果

### 成功案例

✅ **知识科普** (121条)
- "为什么咖啡比茶更加提神？"
- "冲咖啡的最佳粉水比应该是多少？"
- "为什么下雨天的浓缩咖啡总调不好？"

✅ **推荐种草** (46条)
- "深圳好喝的「咖啡村」，适合呆一天"
- "番茄美式好喝不？替你们试了！"

✅ **教程** (28条)
- "全自动咖啡机常见故障及解决办法"
- "你知道"草莓糖"咖啡豆要怎么冲吗？"
- "拉花注意这3点，改善图案不居中！"

✅ **探店** (7条)
- "别再去网红店排队了！广州这10家低调美食店才是吃货的天堂！"
- "香港私藏Cafe" (已有分类)

### 未能分类案例

❌ **营销类** (无对应规则)
- "今晚秒杀！莫扎特、花魁19.9、希爪29.9！！"

❌ **地图类** (无对应规则)
- "2025成都村咖地图（上）"
- "广州2025：社区咖啡店如何重塑城市生活美学？"

❌ **非咖啡内容** (不在业务范围)
- "马斯克2026最新访谈"
- "A股成交再创历史天量"
- "王石和田朴珺的"爱情""

❌ **标题过于简略**
- null (2条)

---

## 规则优化建议

### 已实现的规则

1. ✅ 探店合集 - "N家店铺" (regex: `/\d+[家间].*(店|咖啡|甜品|餐厅)/i`)
2. ✅ 探店合集 - "私藏/宝藏" 关键词
3. ✅ 教程 - "教程/做法/步骤" 关键词
4. ✅ 教程 - "如何/怎么做" 疑问句
5. ✅ 知识 - "为什么" 疑问
6. ✅ 知识 - "原理/知识/最佳" 关键词
7. ✅ 技巧类 → tutorial
8. ✅ 推荐 - "推荐/种草/适合/好喝" 关键词
9. ✅ 测评 - "测评/对比" 关键词
10. ✅ 通用疑问句 → knowledge (兜底)

### 可补充的规则

#### 1. Collection (合集/地图类)

```typescript
// 规则: 地图/合集类 -> collection
if (!category && /(地图|指南|合集|清单|攻略)/.test(title)) {
  category = 'collection'
  confidence = 0.75
}
```

**影响记录**: ~10-20条
- "2025成都村咖地图（上）"
- "广州2025：社区咖啡店..."

#### 2. Vlog/Case Study (深度内容)

```typescript
// 规则: 深度分析类 -> case_study
if (!category && /(如何重塑|趋势|解析|分析|思考)/.test(title)) {
  category = 'case_study'
  confidence = 0.7
}
```

**影响记录**: ~5-10条
- "广州2025：社区咖啡店如何重塑城市生活美学？"

#### 3. DIY/Tutorial细分

```typescript
// 规则: DIY类 -> diy
if (!category && /(试试这个|妙招|小技巧|防.*小)/.test(title)) {
  category = 'diy'
  confidence = 0.7
}
```

**影响记录**: ~15-20条
- "筛出来的咖啡细粉别丢，试试这个防堵小妙招！"
- "分享"三个"找对手冲咖啡粉研磨度的小妙招~"

#### 4. 营销类处理

**建议**: 不纳入分类系统，或创建独立的 `promotion` category

```typescript
// 规则: 营销类 (仅用于标记，不分类)
if (/(秒杀|限时|折扣|\d+\.\d+|买\d+送\d+)/.test(title)) {
  // 标记为营销内容，不设置 category
  metadata.is_promotion = true
}
```

---

## 未分类记录分析

### 为何未分类？

1. **非业务范围** (60%): 时事新闻、娱乐八卦、股票财经
2. **营销内容** (20%): 促销广告、秒杀活动
3. **标题不明确** (15%): 过于简略或专业术语过多
4. **规则覆盖不足** (5%): 地图/合集类、DIY小技巧类

### 处理建议

#### 方案1: 扩充规则 (推荐)

添加 4个新规则 (collection, case_study, diy, vlog)，预计可再分类 **40-50 条**，总覆盖率提升至 **~45%**

#### 方案2: 人工审核

对未分类的 347 条记录进行抽样审核:
- 删除非业务范围内容 (~200条)
- 手动标记边缘案例 (~50条)
- 剩余无法分类的保留为 null

#### 方案3: AI 辅助分类

使用 Claude/GPT 对未分类记录进行二次分类:
- 成本: ~0.1-0.5 USD (347条记录)
- 预期准确率: >90%
- 耗时: ~10-15分钟

---

## 数据质量问题

### 发现的问题

1. **重复标题** (22条)
   - 例如: "拉花注意这3点，改善图案不居中！" 出现2次
   - 建议: 添加去重逻辑

2. **空标题** (2条)
   - `source_title = null`
   - 建议: 数据清洗或标记为无效

3. **非咖啡内容** (~200条)
   - 时事、娱乐、财经等
   - 建议: 检查数据来源，可能需要过滤规则

---

## 下一步行动

### 短期 (1-2天)

- [ ] 添加 collection/diy 规则，提升覆盖率至 45%
- [ ] 数据清洗: 删除非业务范围内容
- [ ] 修复空标题问题
- [ ] 去重处理

### 中期 (1周)

- [ ] 集成到新建任务流程 (自动分类)
- [ ] 添加用户反馈机制 (修正错误分类)
- [ ] 建立分类规则测试集

### 长期 (持续优化)

- [ ] 收集用户修正数据
- [ ] 定期优化规则
- [ ] 考虑引入 AI 辅助分类

---

## 验证方式

### SQL 查询

```sql
-- 查看当前分类分布
SELECT
  category,
  track,
  COUNT(*) as count,
  ROUND(COUNT(*)::numeric / SUM(COUNT(*)) OVER () * 100, 2) AS percentage
FROM xhs_image_jobs
WHERE deleted_at IS NULL
  AND category IS NOT NULL
GROUP BY category, track
ORDER BY count DESC;

-- 查看覆盖率
SELECT
  COUNT(*) AS total,
  COUNT(*) FILTER (WHERE category IS NOT NULL) AS classified,
  ROUND(COUNT(*) FILTER (WHERE category IS NOT NULL)::numeric / COUNT(*) * 100, 2) AS coverage
FROM xhs_image_jobs
WHERE deleted_at IS NULL;

-- 查看未分类记录示例
SELECT source_title
FROM xhs_image_jobs
WHERE deleted_at IS NULL
  AND category IS NULL
LIMIT 20;
```

---

## 结论

✅ **成功完成基础分类**: 203/550 条记录 (36.91%)

✅ **零错误更新**: 所有更新均成功执行

✅ **高质量分类**: 68% 为高置信度分类 (≥0.8)

⚠️ **改进空间**: 通过扩充规则可提升至 45% 覆盖率

📊 **业务洞察**:
- 知识科普类内容占主导 (59.6%)
- 生活方式赛道占绝对优势 (84.2%)
- 探店类内容较少 (3.5%)，需加强此类内容生产

---

**报告生成时间**: 2026-01-26 06:40:00
**日志文件**: `/tmp/xhs-category-backfill.log`
