# n8n å·¥ä½œæµæ‰‹åŠ¨ä¼˜åŒ–æŒ‡å—

ç”±äº n8n JSON å¯¼å…¥çš„å¤æ‚æ€§ï¼Œå»ºè®®ç›´æ¥åœ¨ n8n UI ä¸­è¿›è¡Œä»¥ä¸‹ä¼˜åŒ–æ“ä½œã€‚

---

## ä¼˜åŒ–æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šä¼˜åŒ–æ•°æ®åº“æŸ¥è¯¢ï¼ˆåˆå¹¶ 3 ä¸ªæŸ¥è¯¢ä¸º 1 ä¸ªï¼‰

**å½“å‰çŠ¶æ€**ï¼š
- èŠ‚ç‚¹ `åˆ›ä½œé£æ ¼è¦æ±‚1`ï¼šæŸ¥è¯¢ `style_analyses`
- èŠ‚ç‚¹ `å°é¢å›¾è¦æ±‚1`ï¼šæŸ¥è¯¢ `image_prompts`
- è¿™ä¸¤ä¸ªèŠ‚ç‚¹é€šè¿‡ Merge èŠ‚ç‚¹åˆå¹¶

**ä¼˜åŒ–æ“ä½œ**ï¼š

1. **åˆ é™¤** èŠ‚ç‚¹ï¼š
   - `åˆ›ä½œé£æ ¼è¦æ±‚1`
   - `å°é¢å›¾è¦æ±‚1`

2. **æ·»åŠ ** æ–°çš„ PostgreSQL èŠ‚ç‚¹ï¼Œå‘½åä¸º `load_spec`ï¼š

**é…ç½®**ï¼š
```
Operation: Execute Query
Query:
```
```sql
SELECT
  sa.*,
  ip.prompt as cover_prompt,
  ip.ratio as cover_ratio,
  ip.resolution as cover_resolution,
  ip.model as cover_model
FROM style_analyses sa
LEFT JOIN image_prompts ip ON ip.id = '{{ $json.body.coverPromptId }}'
WHERE sa.id = '{{ $json.body.refMaterialId }}'
```

3. **è¿æ¥**ï¼š
   - `Hono Webhook1` â†’ `load_spec`
   - `load_spec` â†’ `åˆ›ä½œå˜é‡` (æ›¿ä»£åŸæ¥çš„ä¸¤ä¸ªæŸ¥è¯¢èŠ‚ç‚¹)

**æ”¶ç›Š**ï¼šæ•°æ®åº“æŸ¥è¯¢ä» 3 æ¬¡å‡å°‘åˆ° 1 æ¬¡ï¼Œæ€§èƒ½æå‡ ~60%

---

### ç¬¬äºŒæ­¥ï¼šé‡æ„ `global_dna` èŠ‚ç‚¹ï¼ˆåˆ†å±‚ Spec ç»“æ„ï¼‰

**æ‰¾åˆ°èŠ‚ç‚¹**ï¼š`global_dna` (Code èŠ‚ç‚¹)

**æ›¿æ¢ä»£ç **ï¼š

```javascript
const webhookData = $('Hono Webhook1').first().json.body;
const specData = $('load_spec').first().json;  // æ³¨æ„ï¼šæ”¹ä¸º load_spec

// å¦‚æœæœ‰æœç´¢ç´ æï¼Œè·å–
let searchMaterial = "æ— å¤–éƒ¨æœç´¢ç´ æ";
try {
  const searchNode = $('Edit Fields').first();
  if (searchNode && searchNode.json.search_material) {
    searchMaterial = searchNode.json.search_material;
  }
} catch (e) {
  // å¦‚æœæ²¡æœ‰æœç´¢èŠ‚ç‚¹ï¼Œä½¿ç”¨é»˜è®¤å€¼
}

const blueprint = specData.blueprint_data || [];
if (blueprint.length === 0) {
  throw new Error("Blueprint data is missing or empty");
}

// ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–ï¼šåˆ†å±‚ Spec ç»“æ„
const spec = {
  // å…ƒæ•°æ®
  meta: {
    topic: webhookData.topic,
    keywords: webhookData.keywords,
    total_word_count: parseInt(webhookData.totalWordCount) || 4000,
    task_id: webhookData.taskId,
    use_search: webhookData.useSearch || false
  },

  // é£æ ¼èº«ä»½ (System Prompt å±‚)
  identity: {
    archetype: specData.style_identity_data?.archetype || "è§‚å¯Ÿè€…",
    persona_desc: specData.style_identity_data?.persona_desc || "",
    tone_keywords: specData.style_identity_data?.tone_keywords || "",
    energy_level: specData.style_identity_data?.energy_level || "å¹³ç¨³",
    voice_distance: specData.style_identity_data?.voice_distance || "å¹³ç­‰",
    formality_score: specData.style_identity_data?.formality_score || 5
  },

  // åº¦é‡çº¦æŸ (Hard Constraints)
  constraints: {
    rhythm_pattern: specData.metrics_constraints_data?.rhythm_pattern || "",
    target_sent_len: specData.metrics_constraints_data?.target_sent_len || "30å­—",
    target_para_len: specData.metrics_constraints_data?.target_para_len || "3å¥",
    burstiness_logic: specData.metrics_constraints_data?.burstiness_logic || "",
    punctuation_logic: specData.metrics_constraints_data?.punctuation_logic || ""
  },

  // è¯æ³•é€»è¾‘ (Lexical Rules)
  lexical: {
    must_use: specData.lexical_logic_data?.must_use || [],
    must_avoid: specData.lexical_logic_data?.must_avoid || [],
    adj_style: specData.lexical_logic_data?.adj_style || "",
    verb_style: specData.lexical_logic_data?.verb_style || "",
    vocab_tier: specData.lexical_logic_data?.vocab_tier || "",
    mood_particles: specData.lexical_logic_data?.mood_particles || []
  },

  // ä¿®è¾é€»è¾‘ (Rhetorical Strategy)
  rhetoric: {
    arg_style: specData.rhetoric_logic_data?.arg_style || "",
    dominant_device: specData.rhetoric_logic_data?.dominant_device || "",
    opening_pattern: specData.rhetoric_logic_data?.opening_pattern || "",
    closing_pattern: specData.rhetoric_logic_data?.closing_pattern || "",
    device_frequency: specData.rhetoric_logic_data?.device_frequency || "",
    device_sample: specData.rhetoric_logic_data?.device_sample || ""
  },

  // é»„é‡‘æ ·æœ¬ (Golden Reference)
  golden_sample: {
    paragraph: specData.golden_sample_data?.paragraph || "",
    tech_list: specData.golden_sample_data?.tech_list || [],
    reason: specData.golden_sample_data?.reason || ""
  },

  // æ ¸å¿ƒè§„åˆ™ (Quality Gates)
  core_rules: specData.core_rules_data || [],

  // ç”Ÿæˆè“å›¾ (Execution Plan)
  blueprint: blueprint
};

// ğŸ”¥ æ–°å¢ï¼šæ‰¹æ¬¡åˆ’åˆ†é€»è¾‘
const BATCH_SIZE = 5;  // å¯è°ƒæ•´ï¼š3-10
const batches = [];
for (let i = 0; i < blueprint.length; i += BATCH_SIZE) {
  batches.push({
    batch_id: Math.floor(i / BATCH_SIZE) + 1,
    start_index: i,
    end_index: Math.min(i + BATCH_SIZE, blueprint.length),
    blueprints: blueprint.slice(i, i + BATCH_SIZE)
  });
}

// ğŸ”¥ æ–°å¢ï¼šä¸Šä¸‹æ–‡å‡†å¤‡
const executionContext = {
  total_sections: blueprint.length,
  total_batches: batches.length,
  avg_words_per_section: Math.floor(spec.meta.total_word_count / blueprint.length),
  search_material: searchMaterial
};

// ä¸ºæ¯ä¸ª blueprint å‡†å¤‡ä¸Šä¸‹æ–‡
return blueprint.map((bp, index) => {
  // è®¡ç®—å‰æ–‡ä¸Šä¸‹æ–‡ï¼ˆæ»‘åŠ¨çª—å£ï¼šå‰2æ®µï¼‰
  const previousBps = blueprint.slice(Math.max(0, index - 2), index);
  const contextSummary = previousBps.length > 0
    ? `å‰æ–‡å·²å†™ï¼š\n` + previousBps.map(p => `[${p.p_id}] ${p.strategy}`).join('\n')
    : "è¿™æ˜¯æ–‡ç« çš„å¼€ç¯‡éƒ¨åˆ†";

  // è®¡ç®—å‰©ä½™å­—æ•°
  const remainingSections = blueprint.length - index;
  const remainingWords = executionContext.avg_words_per_section * remainingSections;

  return {
    json: {
      p_id: bp.p_id,
      blueprint: bp,

      // ğŸ”¥ æ ¸å¿ƒä¼˜åŒ–ï¼šä¸Šä¸‹æ–‡æ„ŸçŸ¥
      progress: {
        current: index + 1,
        total: blueprint.length,
        remaining_sections: remainingSections,
        remaining_words: remainingWords
      },

      previous_context: contextSummary,

      // åˆ†å±‚ Spec
      global_spec: {
        identity: spec.identity,
        constraints: spec.constraints,
        lexical: spec.lexical,
        rhetoric: spec.rhetoric,
        golden_sample: spec.golden_sample
      },

      meta: spec.meta,
      search_material: executionContext.search_material
    }
  };
});
```

**æ”¶ç›Š**ï¼š
- Spec è¯­ä¹‰æ¸…æ™°ï¼ŒLLM æ›´å®¹æ˜“ç†è§£
- æ¯ä¸ªæ®µè½ç”Ÿæˆæ—¶æºå¸¦ä¸Šä¸‹æ–‡ï¼Œé¿å…é‡å¤
- æ”¯æŒå‰©ä½™å­—æ•°é…é¢è®¡ç®—

---

### ç¬¬ä¸‰æ­¥ï¼šä¼˜åŒ– LLM å†™ä½œèŠ‚ç‚¹çš„ Prompt

**æ‰¾åˆ°èŠ‚ç‚¹**ï¼š`åŸºäºå¤§è¯­è¨€æ¨¡å‹çš„å†™ä½œ`

**ä¿®æ”¹ User Message (ç¬¬äºŒä¸ªæ¶ˆæ¯æ¡†)**ï¼š

```
={{ $json.previous_context }}

---

# å½“å‰æ®µè½ä»»åŠ¡

**è¿›åº¦**: æ­£åœ¨åˆ›ä½œç¬¬ {{ $json.progress.current }} æ®µï¼Œå…± {{ $json.progress.total }} æ®µ
**å‰©ä½™å­—æ•°é…é¢**: {{ $json.progress.remaining_words }} å­—

## å½“å‰æ®µè½è§„èŒƒ (Blueprint)

- **æ®µè½ID**: {{ $json.blueprint.p_id }}
- **ç­–ç•¥**: {{ $json.blueprint.strategy }}
- **æ ¸å¿ƒåŠ¨ä½œ**: {{ $json.blueprint.action }}
- **æ‰§è¡Œå‡†åˆ™**: {{ $json.blueprint.guidelines }}
- **å¥å¼æ¨¡æ¿**: {{ $json.blueprint.pattern_template }}
- **ç›®æ ‡å­—æ•°**: {{ $json.blueprint.word_count_target }}
- **åº”ç”¨æŠ€å·§**: {{ $json.blueprint.techniques.join('ã€') }}

## å‚è€ƒæ ·æœ¬

{{ $json.blueprint.pattern_sample }}

---

## ä¸»é¢˜ä¸ç´ æ

**ä¸»é¢˜**: {{ $json.meta.topic }}
**å…³é”®è¯**: {{ $json.meta.keywords }}

{{ $json.search_material !== 'æ— å¤–éƒ¨æœç´¢ç´ æ' ? '**ç½‘ç»œç´ æ**:\n' + $json.search_material : '' }}

---

## é»„é‡‘æ ·æœ¬å‚è€ƒ

ä»¥ä¸‹æ®µè½å±•ç¤ºäº†ç›®æ ‡é£æ ¼ï¼Œè¯·å‚è€ƒå…¶æŠ€å·§ä½†ä¸è¦ç…§æ¬å†…å®¹ï¼š

> {{ $json.global_spec.golden_sample.paragraph }}

**æŠ€å·§è¦ç‚¹**: {{ $json.global_spec.golden_sample.tech_list.join('ã€') }}

---

## è¾“å‡ºè¦æ±‚

1. **ä¸¥æ ¼éµå¾ª** Blueprint çš„ actionã€pattern_template å’Œ word_count_target
2. **è‡ªç„¶èå…¥** ä¸»é¢˜å’Œå…³é”®è¯ï¼Œé¿å…ç”Ÿç¡¬æ¤å…¥
3. **ä¿æŒè¿è´¯**: æ³¨æ„ä¸å‰æ–‡çš„è¡”æ¥ï¼ˆè§ä¸Šæ–¹"å‰æ–‡å·²å†™"ï¼‰
4. **ç›´æ¥è¾“å‡ºæ­£æ–‡**ï¼Œä¸è¦åŒ…å«ä»»ä½•è¯´æ˜æ€§æ–‡å­—æˆ–æ ‡é¢˜

è¯·å¼€å§‹åˆ›ä½œæœ¬æ®µå†…å®¹ï¼š
```

**ä¿®æ”¹ System Message (ç¬¬ä¸€ä¸ªæ¶ˆæ¯æ¡†)**ï¼š

```
=# è§’è‰²èº«ä»½

ä½ æ˜¯ä¸€ä½ **{{ $json.global_spec.identity.persona_desc }}**

- **åŸå‹**: {{ $json.global_spec.identity.archetype }}
- **è¯­è°ƒ**: {{ $json.global_spec.identity.tone_keywords }}
- **èƒ½é‡çº§åˆ«**: {{ $json.global_spec.identity.energy_level }}
- **å¯¹è¯è·ç¦»**: {{ $json.global_spec.identity.voice_distance }}
- **æ­£å¼åº¦**: {{ $json.global_spec.identity.formality_score }}/10

---

# æ ¸å¿ƒè¯­è¨€æ§åˆ¶

## è¯æ³•çº¦æŸ

- **å¿…é¡»è‡ªç„¶ä½¿ç”¨** (å‚è€ƒï¼Œä¸è¦ç”Ÿç¡¬å †ç Œ): {{ $json.global_spec.lexical.must_use.join('ã€') }}
- **ä¸¥æ ¼ç¦ç”¨**: {{ $json.global_spec.lexical.must_avoid.join('ã€') }}
- **å½¢å®¹è¯é£æ ¼**: {{ $json.global_spec.lexical.adj_style }}
- **åŠ¨è¯åå¥½**: {{ $json.global_spec.lexical.verb_style }}
- **è¯­æ°”è¯**: {{ $json.global_spec.lexical.mood_particles.join('ã€') }}

## åº¦é‡çº¦æŸ

- **èŠ‚å¥æ¨¡å¼**: {{ $json.global_spec.constraints.rhythm_pattern }}
- **ç›®æ ‡å¥é•¿**: {{ $json.global_spec.constraints.target_sent_len }}
- **æ®µè½é•¿åº¦**: {{ $json.global_spec.constraints.target_para_len }}
- **çªå‘æ€§é€»è¾‘**: {{ $json.global_spec.constraints.burstiness_logic }}
- **æ ‡ç‚¹é€»è¾‘**: {{ $json.global_spec.constraints.punctuation_logic }}

## ä¿®è¾ç­–ç•¥

- **è®ºè¯é£æ ¼**: {{ $json.global_spec.rhetoric.arg_style }}
- **ä¸»å¯¼æ‰‹æ³•**: {{ $json.global_spec.rhetoric.dominant_device }}
- **å¼€ç¯‡æ¨¡å¼**: {{ $json.global_spec.rhetoric.opening_pattern }}
- **æ”¶å°¾æ¨¡å¼**: {{ $json.global_spec.rhetoric.closing_pattern }}
- **æ‰‹æ³•é¢‘ç‡**: {{ $json.global_spec.rhetoric.device_frequency }}

---

# å†™ä½œè´Ÿé¢æ¸…å•

- ä»»ä½•æ„è±¡/æ¦‚å¿µè¯ï¼ˆå¦‚"å¤©é™…çº¿""é”»é€ ""èµ‹èƒ½"ï¼‰å…¨æ–‡ä¸è¶…è¿‡2æ¬¡
- ç¦æ­¢åœ¨æ¯æ®µé‡å¤ä½¿ç”¨åŒä¸€ç»„æ ¸å¿ƒè¯æ±‡çš„æ’åˆ—ç»„åˆ
- ç¦æ­¢ç”¨åŠ ç²—æ ‡è®°å¼ºè¡Œæ¤å…¥å…³é”®è¯
- ç¦ç”¨"è¿™ä¸æ˜¯Xï¼Œè€Œæ˜¯Y"å¥å¼ï¼Œé™¤éç´§éšå…¶åæœ‰å…·ä½“è®ºè¯
- ç¦ç”¨"æœ¬è´¨ä¸Šæ˜¯â€¦â€¦""çœŸæ­£çš„â€¦â€¦åœ¨äºâ€¦â€¦"ç­‰æŠ½è±¡å‡åï¼Œé™¤éèƒ½ç”¨äº‹å®æ”¯æ’‘
- ç¦æ­¢è¿ç»­ä¸‰å¥ä»¥ä¸Šæ— å…·ä½“ä¿¡æ¯çš„æŠ’æƒ…/å®£è¨€å¼è¡¨è¾¾
```

**æ”¶ç›Š**ï¼š
- LLM èƒ½çœ‹åˆ°å‰æ–‡ä¸Šä¸‹æ–‡ï¼Œé¿å…é‡å¤
- æ˜ç¡®å‰©ä½™å­—æ•°é…é¢ï¼Œåˆç†åˆ†é…
- åˆ†å±‚ Spec æ›´æ¸…æ™°

---

### ç¬¬å››æ­¥ï¼šåˆ é™¤å†—ä½™èŠ‚ç‚¹

**åˆ é™¤ä»¥ä¸‹èŠ‚ç‚¹**ï¼š
- `Aggregate1` (åœ¨ global_dna å’Œå†™ä½œèŠ‚ç‚¹ä¹‹é—´ï¼Œä½œç”¨ä¸æ˜)

**ä¿ç•™**ï¼š
- `Aggregate` (åœ¨æ‰€æœ‰å†™ä½œèŠ‚ç‚¹åï¼Œç”¨äºèšåˆç»“æœ)

---

### ç¬¬äº”æ­¥ï¼šå¹¶è¡ŒåŒ–æ•°æ®åº“å†™å…¥

**å½“å‰çŠ¶æ€**ï¼š
```
Basic LLM Chain â†’ Insert rows â†’ Update rows
```

**ä¼˜åŒ–æ“ä½œ**ï¼š

1. **æ–­å¼€** `Insert rows in a table` â†’ `Update rows in a table` çš„è¿æ¥

2. **é‡æ–°è¿æ¥**ï¼š
   - `Basic LLM Chain` â†’ `Insert rows in a table`
   - `Basic LLM Chain` â†’ `Update rows in a table`

   (ä»åŒä¸€ä¸ªèŠ‚ç‚¹æ‹–ä¸¤æ¡çº¿å‡ºæ¥)

**æ”¶ç›Š**ï¼šä¸¤ä¸ªæ•°æ®åº“æ“ä½œå¹¶è¡Œæ‰§è¡Œï¼Œå‡å°‘ç­‰å¾…æ—¶é—´çº¦ 50%

---

## æµ‹è¯•æ£€æŸ¥æ¸…å•

å®Œæˆä¼˜åŒ–åï¼Œè¯·æµ‹è¯•ä»¥ä¸‹åœºæ™¯ï¼š

### 1. åŸºç¡€åŠŸèƒ½æµ‹è¯•
- [ ] Webhook èƒ½æ­£å¸¸æ¥æ”¶è¯·æ±‚
- [ ] æ•°æ®åº“èƒ½æ­£ç¡®æŸ¥è¯¢åˆ° spec æ•°æ®
- [ ] æœç´¢åˆ†æ”¯ (useSearch=true/false) éƒ½èƒ½æ­£å¸¸å·¥ä½œ
- [ ] æ‰€æœ‰æ®µè½éƒ½èƒ½ç”Ÿæˆï¼ˆæ£€æŸ¥ Aggregate èŠ‚ç‚¹è¾“å‡ºï¼‰
- [ ] æœ€ç»ˆæ–‡ç« èƒ½æ­£ç¡®ä¿å­˜åˆ°æ•°æ®åº“

### 2. Spec é©±åŠ¨éªŒè¯
- [ ] ç”Ÿæˆçš„æ–‡ç« ç¬¦åˆ `tone_keywords` é£æ ¼
- [ ] ä½¿ç”¨äº† `must_use` è¯æ±‡
- [ ] æ²¡æœ‰ä½¿ç”¨ `must_avoid` è¯æ±‡
- [ ] æ®µè½å­—æ•°æ¥è¿‘ `word_count_target`

### 3. ä¸Šä¸‹æ–‡è¿è´¯æ€§
- [ ] æ®µè½ä¹‹é—´æ²¡æœ‰æ˜æ˜¾é‡å¤å†…å®¹
- [ ] å™äº‹é€»è¾‘è¿è´¯ï¼Œæ²¡æœ‰æ–­è£‚
- [ ] å‰åæ®µè½èƒ½å¤Ÿå‘¼åº”

### 4. æ€§èƒ½æ£€æŸ¥
- [ ] æ•´ä½“æ‰§è¡Œæ—¶é—´ï¼ˆç›®æ ‡ï¼š3-5 åˆ†é’Ÿå®Œæˆ 38 æ®µï¼‰
- [ ] æ•°æ®åº“æŸ¥è¯¢æ¬¡æ•°ï¼ˆåº”è¯¥åªæœ‰ 1 æ¬¡ SELECTï¼‰
- [ ] LLM è°ƒç”¨æ¬¡æ•°ï¼ˆ38 æ®µ + 1 æ¬¡ç»ˆå®¡ = 39 æ¬¡ï¼‰

---

## æ•…éšœæ’æŸ¥

### é—®é¢˜ 1ï¼š`load_spec` èŠ‚ç‚¹æŠ¥é”™
**åŸå› **ï¼šJOIN æŸ¥è¯¢è¯­æ³•é”™è¯¯æˆ–å­—æ®µä¸å­˜åœ¨
**è§£å†³**ï¼šæ£€æŸ¥æ•°æ®åº“ schemaï¼Œç¡®è®¤å­—æ®µåç§°

### é—®é¢˜ 2ï¼š`global_dna` èŠ‚ç‚¹æŠ¥é”™ "Cannot read property"
**åŸå› **ï¼šspec æ•°æ®ç»“æ„ç¼ºå¤±
**è§£å†³**ï¼šæ·»åŠ  `|| {}` æˆ– `|| []` é»˜è®¤å€¼

### é—®é¢˜ 3ï¼šæ®µè½ç”Ÿæˆé‡å¤å†…å®¹
**åŸå› **ï¼š`previous_context` æœªæ­£ç¡®ä¼ é€’
**è§£å†³**ï¼šæ£€æŸ¥ `global_dna` èŠ‚ç‚¹ä¸­çš„ä¸Šä¸‹æ–‡è®¡ç®—é€»è¾‘

### é—®é¢˜ 4ï¼šæœ€ç»ˆæ–‡ç« æœªä¿å­˜
**åŸå› **ï¼šå¹¶è¡Œå†™å…¥æ—¶èŠ‚ç‚¹è¿æ¥é”™è¯¯
**è§£å†³**ï¼šç¡®ä¿ä¸¤ä¸ªæ•°æ®åº“èŠ‚ç‚¹éƒ½è¿æ¥åˆ° `Basic LLM Chain`

---

## è¿›é˜¶ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

### A. æ·»åŠ æ®µè½éªŒè¯
åœ¨ `Aggregate` èŠ‚ç‚¹åæ·»åŠ  Code èŠ‚ç‚¹ï¼š

```javascript
const allSections = $input.all()[0].json.data;

// éªŒè¯æ¯ä¸ªæ®µè½
const validation = allSections.map(section => {
  const text = section.text || "";
  const errors = [];

  // æ£€æŸ¥ç¦ç”¨è¯
  const mustAvoid = ["æˆ‘è§‰å¾—", "éå¸¸", "å¯èƒ½", "å¤§æ¦‚"];
  mustAvoid.forEach(word => {
    if (text.includes(word)) {
      errors.push(`åŒ…å«ç¦ç”¨è¯: ${word}`);
    }
  });

  return {
    p_id: section.p_id || "unknown",
    word_count: text.length,
    errors: errors,
    is_valid: errors.length === 0
  };
});

// è¾“å‡ºéªŒè¯æŠ¥å‘Š
return {
  json: {
    validation_report: validation,
    total_sections: allSections.length,
    failed_sections: validation.filter(v => !v.is_valid).length
  }
};
```

### B. è°ƒæ•´æ‰¹æ¬¡å¤§å°
ä¿®æ”¹ `global_dna` èŠ‚ç‚¹ä¸­çš„ `BATCH_SIZE`ï¼š
- `3`: æœ€é«˜è´¨é‡ï¼Œæœ€æ…¢
- `5`: å¹³è¡¡ï¼ˆæ¨èï¼‰
- `10`: æœ€å¿«ï¼Œå¯èƒ½æœ‰è½»å¾®é‡å¤

---

## æ€»ç»“

| ä¼˜åŒ–é¡¹ | é¢„æœŸæ”¶ç›Š |
|--------|---------|
| åˆå¹¶æ•°æ®åº“æŸ¥è¯¢ | æ€§èƒ½æå‡ 60% |
| åˆ†å±‚ Spec ç»“æ„ | è´¨é‡æå‡ï¼ˆè¯­ä¹‰æ¸…æ™°ï¼‰ |
| ä¸Šä¸‹æ–‡æ„ŸçŸ¥ç”Ÿæˆ | é‡å¤ç‡é™ä½ 80% |
| å¹¶è¡ŒåŒ–å†™å…¥ | ç­‰å¾…æ—¶é—´å‡å°‘ 50% |
| åˆ é™¤å†—ä½™èŠ‚ç‚¹ | å¯ç»´æŠ¤æ€§æå‡ |

**æ€»ä½“é¢„æœŸ**ï¼š
- æ‰§è¡Œæ—¶é—´ï¼š4-6 åˆ†é’Ÿï¼ˆåŸ ~8 åˆ†é’Ÿï¼‰
- æ–‡ç« è´¨é‡ï¼šæ˜¾è‘—æå‡ï¼ˆè¿è´¯æ€§ã€é£æ ¼ä¸€è‡´æ€§ï¼‰
- è°ƒè¯•éš¾åº¦ï¼šé™ä½ï¼ˆç»“æ„æ¸…æ™°ï¼‰
